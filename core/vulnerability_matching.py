from core.vulnerability_fetcher import fetch_nvd_data
from core.vulnerability_processor import process_nvd_data
from core.device_identifier import DeviceIdentifier  # Import DeviceIdentifier to access map_to_cpe

def match_vulnerabilities(device):
    manufacturer = device.get("manufacturer")
    
    vulnerabilities = []

    nvd_data = fetch_nvd_data(manufacturer)
    processed_nvd = process_nvd_data(nvd_data)
    if processed_nvd:
        vulnerabilities.extend(processed_nvd)

    return vulnerabilities
